import{d as U,r as w,h as j,i as z,c as p,a as s,b as t,f as l,t as r,w as o,o as m,_ as D,e as i,F as L,k as R,j as A,s as P}from"./D0_loxAU.js";import{_ as S}from"./2t6NhyjD.js";import{_ as V,a as q,b as E,c as H,d as M,e as G}from"./8Jew3ux9.js";import{a as J,u as K}from"./DfhhxIwp.js";import"./oVxJKGu7.js";import"./BNf5BS2b.js";import"./CxRmHzWs.js";const O={class:"space-y-4"},Q={class:"flex items-center justify-between"},W={class:"flex items-center gap-3"},X={class:"p-2 rounded-lg bg-blue-500/10"},Y={key:0,class:"rounded-md border bg-card p-8"},Z={class:"flex flex-col items-center justify-center gap-2 text-muted-foreground"},ee={key:1,class:"rounded-md border border-destructive/50 bg-destructive/10 p-8"},te={class:"flex flex-col items-center justify-center gap-2 text-destructive"},se={class:"text-sm"},oe={key:2,class:"rounded-md border-2 border-dashed bg-card p-12"},ne={class:"flex flex-col items-center justify-center gap-3 text-muted-foreground"},ae={key:3,class:"rounded-md border bg-card text-card-foreground shadow-sm"},le={class:"flex flex-col min-w-0"},de={class:"text-sm font-medium text-foreground truncate"},ie={class:"text-xs text-muted-foreground md:hidden"},ce={class:"text-xs font-medium px-2 py-1 rounded bg-muted text-muted-foreground"},he=U({__name:"recent",setup(re){const{formatFileSize:k,formatDate:F,getFileIcon:$,getIconColor:C}=J(),{accounts:y}=K(),x=w([]),b=w(!0),g=w(null),h=async()=>{var d;b.value=!0,g.value=null,x.value=[];try{const e=y.value.map(async n=>{try{return(await $fetch("/api/dropbox/recent",{query:{accountId:n.id}})).entries.map(_=>({..._,accountId:n.id,accountName:n.name}))}catch(c){return console.warn(`Failed to fetch recent for ${n.name}:`,c),[]}}),v=(await Promise.all(e)).flat();x.value=v.sort((n,c)=>{const _=n.modified?new Date(n.modified).getTime():0;return(c.modified?new Date(c.modified).getTime():0)-_})}catch(e){g.value=((d=e.data)==null?void 0:d.message)||e.message||"Failed to load recent files"}finally{b.value=!1}};j(()=>{h()}),z(y,()=>{h()},{deep:!0});const T=d=>{if(!d)return"/";const e=d.split("/");return e.pop(),e.join("/")||"/"},B=async d=>{try{const e=await $fetch("/api/dropbox/download",{query:{path:d.path,accountId:d.accountId}});e.link&&window.open(e.link,"_blank")}catch(e){console.error("Error opening file:",e)}};return(d,e)=>{const u=D,v=S,n=H,c=E,_=q,f=G,N=M,I=V;return m(),p("div",O,[s("div",Q,[s("div",W,[s("div",X,[t(u,{name:"lucide:clock",class:"h-5 w-5 text-blue-500"})]),e[0]||(e[0]=s("div",null,[s("h1",{class:"text-xl font-semibold"},"Recent Files"),s("p",{class:"text-sm text-muted-foreground"},"Files you've recently accessed or modified")],-1))])]),l(b)?(m(),p("div",Y,[s("div",Z,[t(u,{name:"lucide:loader-2",class:"h-8 w-8 animate-spin"}),e[1]||(e[1]=s("p",null,"Loading recent files...",-1))])])):l(g)?(m(),p("div",ee,[s("div",te,[t(u,{name:"lucide:alert-circle",class:"h-8 w-8"}),e[3]||(e[3]=s("p",{class:"font-medium"},"Failed to load recent files",-1)),s("p",se,r(l(g)),1),t(v,{variant:"outline",size:"sm",onClick:h,class:"mt-2"},{default:o(()=>[t(u,{name:"lucide:refresh-cw",class:"mr-2 h-4 w-4"}),e[2]||(e[2]=i(" Retry ",-1))]),_:1})])])):l(x).length===0?(m(),p("div",oe,[s("div",ne,[t(u,{name:"lucide:clock",class:"h-16 w-16"}),e[4]||(e[4]=s("p",{class:"font-medium text-lg"},"No recent files",-1)),e[5]||(e[5]=s("p",{class:"text-sm"},"Files you access or modify will appear here",-1))])])):(m(),p("div",ae,[t(I,null,{default:o(()=>[t(_,null,{default:o(()=>[t(c,{class:"hover:bg-transparent"},{default:o(()=>[t(n,{class:"min-w-[200px]"},{default:o(()=>[...e[6]||(e[6]=[i("Name",-1)])]),_:1}),t(n,{class:"hidden md:table-cell"},{default:o(()=>[...e[7]||(e[7]=[i("Account",-1)])]),_:1}),t(n,{class:"hidden md:table-cell"},{default:o(()=>[...e[8]||(e[8]=[i("Location",-1)])]),_:1}),t(n,{class:"hidden md:table-cell"},{default:o(()=>[...e[9]||(e[9]=[i("Size",-1)])]),_:1}),t(n,{class:"text-right hidden md:table-cell"},{default:o(()=>[...e[10]||(e[10]=[i("Modified",-1)])]),_:1})]),_:1})]),_:1}),t(N,null,{default:o(()=>[(m(!0),p(L,null,R(l(x),a=>(m(),A(c,{key:a.id,class:"group cursor-pointer hover:bg-muted/50",onClick:ue=>B(a)},{default:o(()=>[t(f,{class:"font-medium flex items-center gap-3 py-3"},{default:o(()=>[s("div",{class:P(["p-2 rounded shrink-0",l(C)(a)])},[t(u,{name:l($)(a),class:"h-4 w-4"},null,8,["name"])],2),s("div",le,[s("span",de,r(a.name),1),s("span",ie,r(a.accountName)+" â€¢ "+r(l(k)(a.size)),1)])]),_:2},1024),t(f,{class:"hidden md:table-cell"},{default:o(()=>[s("span",ce,r(a.accountName),1)]),_:2},1024),t(f,{class:"text-muted-foreground text-sm hidden md:table-cell"},{default:o(()=>[i(r(T(a.path)),1)]),_:2},1024),t(f,{class:"text-muted-foreground hidden md:table-cell"},{default:o(()=>[i(r(l(k)(a.size)),1)]),_:2},1024),t(f,{class:"text-right text-muted-foreground hidden md:table-cell"},{default:o(()=>[i(r(l(F)(a.modified)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]))])}}});export{he as default};
