import{d as ee,I as te,r as m,g as k,h as se,P as le,c as i,a as t,b as a,l as p,f as s,t as d,w as U,e as F,j as oe,F as ae,k as ne,Z as ie,o as n,_ as re,s as H}from"./D0_loxAU.js";import{_ as de}from"./Mvjefoez.js";import{_ as ce}from"./2t6NhyjD.js";import{s as ue,_ as me}from"./BRF61fbF.js";import"./oVxJKGu7.js";import"./BNf5BS2b.js";import"./P7PFuRdT.js";import"./B5rdlIOA.js";const fe={class:"min-h-screen bg-background font-sans text-foreground flex flex-col"},he={class:"sticky top-0 z-50 w-full border-b bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/60"},ve={class:"max-w-7xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between"},xe={href:"/",class:"flex items-center gap-2 font-bold text-xl hover:opacity-80 transition-opacity"},pe={class:"bg-[#0061FE] text-white p-1.5 rounded-lg"},ge={class:"flex-1 w-full max-w-6xl mx-auto p-4 md:p-8 md:py-12"},_e={key:0,class:"flex flex-col items-center justify-center min-h-[50vh]"},we={key:1,class:"flex flex-col items-center justify-center min-h-[50vh] text-center max-w-md mx-auto"},be={class:"w-20 h-20 bg-red-50 dark:bg-red-900/20 rounded-full flex items-center justify-center mb-6"},ye={class:"text-muted-foreground mb-8"},ke={key:2,class:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500"},Fe={class:"flex flex-col md:flex-row md:items-start justify-between gap-6"},$e={class:"flex-1 min-w-0"},Ee={class:"flex items-center gap-3 mb-2"},Be={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"},je={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-50 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300"},Ce={class:"text-3xl md:text-4xl font-bold tracking-tight text-foreground break-words leading-tight"},Ie={class:"flex flex-wrap items-center gap-x-4 gap-y-2 mt-4 text-sm text-muted-foreground"},Me={class:"flex items-center gap-1.5"},Ne={class:"flex items-center gap-1.5"},Ve={class:"flex items-center gap-1.5"},De={class:"hidden md:block shrink-0"},Se={key:0,class:"rounded-lg border-l-4 border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 p-4"},Te={class:"flex"},ze={class:"flex-shrink-0"},Le={class:"ml-3"},Ue={class:"text-sm text-yellow-700 dark:text-yellow-200"},Ae={class:"w-full"},Pe={key:0,class:"rounded-2xl overflow-hidden relative shadow-2xl bg-black ring-1 ring-white/10"},Re={key:0,class:"flex items-center justify-center h-64 bg-gray-900 text-white"},qe={key:1,class:"flex items-center justify-center h-64 bg-gray-900 text-red-500"},Ge={key:1,class:"bg-card border rounded-2xl p-8 shadow-sm flex flex-col items-center"},He={class:"w-24 h-24 bg-blue-50 dark:bg-blue-900/20 rounded-2xl flex items-center justify-center mb-6 text-[#0061FE]"},Ke={class:"text-lg font-medium mb-6"},Ye=["src"],Ze={key:2,class:"bg-muted/10 rounded-2xl overflow-hidden border shadow-sm flex justify-center"},Je=["src","alt"],Oe={key:3,class:"bg-card border rounded-xl overflow-hidden shadow-sm"},Qe={class:"px-6 py-4 border-b bg-muted/30 flex items-center justify-between"},We={class:"font-semibold"},Xe={class:"divide-y max-h-[500px] overflow-auto"},et={class:"h-10 w-10 rounded-lg bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-[#0061FE] shrink-0"},tt={class:"flex-1 min-w-0"},st={class:"text-xs text-muted-foreground mt-0.5"},lt={class:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},ot=["onClick"],at=["onClick"],nt={class:"md:hidden pt-4"},pt=ee({__name:"[id]",setup(it){const M=["mp4","webm","mkv","avi","mov"],N=["mp3","wav","ogg","flac","m4a"],A=["jpg","jpeg","png","gif","webp","bmp"],w=l=>{var e;return((e=l.split(".").pop())==null?void 0:e.toLowerCase())||""},$=te().params.id,c=m(null),V=m(!0),f=m(!1),E=m(null),x=m(""),g=m(!1),D=m(!1),S=m(""),K=m(null),b=m(""),_=m("video/mp4");let T;const r=k(()=>{var l;return((l=c.value)==null?void 0:l.files)||[]}),u=k(()=>r.value.length>1),P=k(()=>r.value.filter(l=>l.available===!1).length),C=k(()=>r.value.length!==1?!1:M.includes(w(r.value[0].name))),Y=k(()=>r.value.length!==1?!1:N.includes(w(r.value[0].name))),Z=k(()=>r.value.length!==1?!1:A.includes(w(r.value[0].name))),J=l=>{const e=w(l);return M.includes(e)||N.includes(e)},O=l=>{const e=w(l);return M.includes(e)?"lucide:video":N.includes(e)?"lucide:music":A.includes(e)?"lucide:image":["pdf"].includes(e)?"lucide:file-text":["zip","rar","7z"].includes(e)?"lucide:archive":"lucide:file"},I=l=>`/api/shares/${$}/stream?fileIndex=${l}`,R=l=>{if(!l||l===0)return"0 B";const e=1024,o=["B","KB","MB","GB"],h=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,h)).toFixed(2))+" "+o[h]},q=()=>{if(!c.value)return;if(!c.value.expiresAt){x.value="Never expires",g.value=!1;return}const l=new Date(c.value.expiresAt),e=new Date,o=l.getTime()-e.getTime();if(o<=0){x.value="Expired",g.value=!0,E.value="This share link has expired";return}const h=Math.floor(o/(1e3*60*60*24)),y=Math.floor(o%(1e3*60*60*24)/(1e3*60*60)),B=Math.floor(o%(1e3*60*60)/(1e3*60)),j=Math.floor(o%(1e3*60)/1e3);h>0?(x.value=`${h}d ${y}h`,g.value=!1):y>0?(x.value=`${y}h ${B}m`,g.value=!1):B>0?(x.value=`${B}m ${j}s`,g.value=!0):(x.value=`${j}s`,g.value=!0)},Q=async()=>{if(!C.value||u.value||!r.value.length)return;const l=r.value[0],e=w(l.name);b.value="",S.value="",D.value=!0;try{if(["mkv","mp4","mov"].includes(e)){_.value="application/x-mpegURL";const o=await $fetch(`/api/shares/${$}/transcode`,{query:{fileIndex:0}}),h="/api/proxy/hls?url=";b.value=h+encodeURIComponent(o.url)}else e==="webm"?_.value="video/webm":e==="avi"?_.value="video/x-msvideo":_.value="video/mp4",b.value=I(0)}catch(o){console.error("Failed to prepare stream:",o),console.warn("Falling back to direct stream..."),_.value="video/mp4",e==="webm"&&(_.value="video/webm"),b.value=I(0)}finally{D.value=!1}},W=async()=>{var l;V.value=!0,E.value=null;try{const e=await $fetch(`/api/shares/${$}/download`);c.value=e,q(),T=ue(q,1e3),await ie(),console.log("[File Viewer] fileInfo:",e),console.log("[File Viewer] files:",r.value),console.log("[File Viewer] isVideo:",C.value,"isBatch:",u.value),C.value&&!u.value&&(console.log("[File Viewer] Preparing video stream..."),await Q())}catch(e){E.value=((l=e.data)==null?void 0:l.message)||e.message||"Failed to load file"}finally{V.value=!1}},z=async l=>{if(c.value){f.value=!0;try{window.location.href=`/api/shares/${$}/stream?fileIndex=${l}`}finally{setTimeout(()=>{f.value=!1},2e3)}}},G=async()=>{f.value=!0,window.location.href=`/api/shares/${$}/download-all`,setTimeout(()=>{f.value=!1},3e3)};return se(()=>{W()}),le(()=>{T&&clearInterval(T)}),(l,e)=>{var j;const o=re,h=de,y=ce,B=me;return n(),i("div",fe,[t("header",he,[t("div",ve,[t("a",xe,[t("div",pe,[a(o,{name:"lucide:hard-drive",class:"h-5 w-5"})]),e[2]||(e[2]=t("span",null,"MultiBox",-1))])])]),t("main",ge,[s(V)?(n(),i("div",_e,[a(o,{name:"lucide:loader-2",class:"w-10 h-10 text-[#0061FE] animate-spin mb-4"}),e[3]||(e[3]=t("p",{class:"text-muted-foreground font-medium"},"Loading file...",-1))])):s(E)?(n(),i("div",we,[t("div",be,[a(o,{name:"lucide:file-warning",class:"h-10 w-10 text-red-500"})]),e[5]||(e[5]=t("h1",{class:"text-2xl font-bold mb-3"},"Link Unavailable",-1)),t("p",ye,d(s(E)),1),a(h,{to:"/",class:"inline-flex items-center justify-center h-11 px-8 rounded-full bg-[#0061FE] text-white font-medium hover:bg-[#0057E5] transition-colors shadow-lg hover:shadow-xl hover:-translate-y-0.5 transform duration-200"},{default:U(()=>[a(o,{name:"lucide:arrow-left",class:"h-4 w-4 mr-2"}),e[4]||(e[4]=F(" Back to Home ",-1))]),_:1})])):s(c)?(n(),i("div",ke,[t("div",Fe,[t("div",$e,[t("div",Ee,[t("span",Be,d(s(u)?"Folder Share":"Shared File"),1),s(g)?(n(),i("span",je," Expires "+d(s(x)),1)):p("",!0)]),t("h1",Ce,d(s(c).fileName),1),t("div",Ie,[t("div",Me,[a(o,{name:"lucide:hard-drive",class:"h-4 w-4"}),F(" "+d(s(u)?`${s(r).length} items`:R((j=s(r)[0])==null?void 0:j.size)),1)]),e[6]||(e[6]=t("div",{class:"h-1 w-1 rounded-full bg-border"},null,-1)),t("div",Ne,[a(o,{name:"lucide:download-cloud",class:"h-4 w-4"}),F(" "+d(s(c).downloadCount)+" downloads ",1)]),e[7]||(e[7]=t("div",{class:"h-1 w-1 rounded-full bg-border"},null,-1)),t("div",Ve,[a(o,{name:"lucide:clock",class:"h-4 w-4"}),F(" "+d(s(c).expiresAt?s(x):"Never expires"),1)])])]),t("div",De,[a(y,{onClick:e[0]||(e[0]=v=>s(u)?G():z(0)),disabled:s(f),size:"lg",class:"h-12 px-8 text-base bg-[#0061FE] hover:bg-[#0057E5] text-white shadow-lg shadow-blue-500/20 rounded-full"},{default:U(()=>[a(o,{name:s(f)?"lucide:loader-2":"lucide:download",class:H([s(f)?"animate-spin":"","mr-2 h-5 w-5"])},null,8,["name","class"]),F(" "+d(s(f)?"Downloading...":"Download Now"),1)]),_:1},8,["disabled"])])]),s(P)>0?(n(),i("div",Se,[t("div",Te,[t("div",ze,[a(o,{name:"lucide:alert-triangle",class:"h-5 w-5 text-yellow-500"})]),t("div",Le,[t("p",Ue,d(s(P))+" file(s) in this share are no longer available. ",1)])])])):p("",!0),t("div",Ae,[s(C)&&!s(u)?(n(),i("div",Pe,[s(D)?(n(),i("div",Re,[a(o,{name:"lucide:loader-2",class:"w-8 h-8 animate-spin mr-2"}),e[8]||(e[8]=t("span",null,"Preparing stream...",-1))])):s(S)?(n(),i("div",qe,[a(o,{name:"lucide:alert-circle",class:"w-8 h-8 mr-2"}),t("span",null,d(s(S)),1)])):s(b)?(n(),oe(B,{key:2,src:s(b),type:s(_),title:s(c).fileName},null,8,["src","type","title"])):p("",!0)])):s(Y)&&!s(u)?(n(),i("div",Ge,[t("div",He,[a(o,{name:"lucide:music",class:"h-10 w-10"})]),t("h3",Ke,d(s(c).fileName),1),t("audio",{src:I(0),controls:"",preload:"metadata",class:"w-full max-w-2xl"}," Your browser does not support audio playback. ",8,Ye)])):s(Z)&&!s(u)?(n(),i("div",Ze,[t("img",{src:I(0),alt:s(c).fileName,class:"max-w-full max-h-[80vh] object-contain shadow-md"},null,8,Je)])):p("",!0),s(u)?(n(),i("div",Oe,[t("div",Qe,[t("h3",We,"Contains "+d(s(r).length)+" Files",1)]),t("div",Xe,[(n(!0),i(ae,null,ne(s(r),(v,L)=>(n(),i("div",{key:L,class:"group flex items-center gap-4 px-6 py-4 hover:bg-muted/50 transition-colors"},[t("div",et,[a(o,{name:O(v.name),class:"h-5 w-5"},null,8,["name"])]),t("div",tt,[t("h4",{class:H(["font-medium text-sm truncate",!v.available&&"text-muted-foreground line-through"])},d(v.name),3),t("p",st,d(R(v.size)),1)]),t("div",lt,[v.available&&J(v.name)?(n(),i("button",{key:0,onClick:X=>K.value=L,class:"p-2 rounded-full hover:bg-background text-[#0061FE] transition-colors",title:"Preview"},[a(o,{name:"lucide:play-circle",class:"h-5 w-5"})],8,ot)):p("",!0),v.available?(n(),i("button",{key:1,onClick:X=>z(L),class:"p-2 rounded-full hover:bg-background text-muted-foreground hover:text-foreground transition-colors",title:"Download"},[a(o,{name:"lucide:download",class:"h-5 w-5"})],8,at)):p("",!0)])]))),128))])])):p("",!0)]),t("div",nt,[a(y,{onClick:e[1]||(e[1]=v=>s(u)?G():z(0)),disabled:s(f),class:"w-full h-12 text-base rounded-full bg-[#0061FE]"},{default:U(()=>[F(d(s(f)?"Downloading...":"Download File"),1)]),_:1},8,["disabled"])])])):p("",!0)]),e[9]||(e[9]=t("footer",{class:"py-8 text-center text-sm text-muted-foreground border-t mt-auto"},[t("p",null,"Â© 2026 MultiBox. Secure file sharing.")],-1))])}}});export{pt as default};
