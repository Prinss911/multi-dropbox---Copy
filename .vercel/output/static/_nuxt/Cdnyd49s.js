import{d as pe,r as _,g as V,c as w,a as e,j as N,b as m,w as me,l as X,f as i,s as A,m as O,t as f,F as Y,k as K,x as Z,e as j,T as fe,_ as ge,o as c,n as he,Y as xe,E as be}from"./D0_loxAU.js";import{_ as ve}from"./Mvjefoez.js";const _e={class:"min-h-screen bg-background flex flex-col items-center justify-center relative overflow-hidden"},we={class:"absolute top-0 left-0 right-0 p-6 flex justify-between items-center z-10"},ye={class:"h-9 w-9 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center text-white shadow-md shadow-blue-500/20"},ke={class:"w-full max-w-2xl px-4 relative z-10"},Ee={class:"bg-card/50 backdrop-blur-xl border shadow-xl rounded-2xl overflow-hidden transition-all duration-500"},ze={key:0,class:"p-8 sm:p-12 animate-in fade-in zoom-in-95 duration-300"},Fe={class:"flex flex-col items-center gap-4 transition-transform duration-300 group-hover:-translate-y-1"},Ce={class:"h-16 w-16 rounded-full bg-blue-50 dark:bg-blue-500/10 flex items-center justify-center text-[#0061FE]"},Ie={class:"space-y-1"},$e={class:"text-sm text-muted-foreground"},Ae={class:"mt-10"},Se={class:"flex items-center justify-center gap-2 mb-4"},Ue={class:"flex flex-wrap justify-center gap-2"},Te=["onClick"],De={key:1,class:"p-8 sm:p-12 animate-in fade-in slide-in-from-bottom-4 duration-300"},Me={class:"text-center mb-8"},Re={class:"flex items-center justify-center gap-3 text-[#0061FE] mb-2"},Be={class:"text-muted-foreground"},He={class:"bg-muted/50 rounded-full h-2 w-full overflow-hidden mb-8"},Ne={class:"space-y-3 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar"},Oe={class:"h-10 w-10 rounded-lg bg-background flex items-center justify-center shrink-0 shadow-sm"},je={class:"flex-1 min-w-0"},Pe={class:"flex justify-between mb-1"},qe={class:"font-medium text-sm truncate"},Le={class:"text-xs font-mono text-muted-foreground ml-2 shrink-0"},Je={class:"h-1 w-full bg-muted rounded-full overflow-hidden"},Ve={class:"shrink-0"},Xe={key:2,class:"h-5 w-5 rounded-full border-2 border-muted border-t-transparent animate-spin"},Ye={key:2,class:"p-8 sm:p-12 text-center animate-in zoom-in-95 duration-500"},Ke={class:"w-20 h-20 bg-green-100 dark:bg-green-500/20 text-green-600 dark:text-green-400 rounded-full flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_rgba(34,197,94,0.3)] animate-bounce-slow"},Ze={class:"bg-muted/30 rounded-xl p-1 mb-8 border"},Ge={class:"flex items-center gap-2 p-3"},Qe={class:"h-10 w-10 bg-background rounded-lg flex items-center justify-center text-[#0061FE] shrink-0 border"},We=["value"],et={class:"px-4 py-2 border-t flex justify-between text-xs text-muted-foreground bg-muted/20"},tt={class:"font-medium text-foreground"},st={class:"text-center text-xs text-muted-foreground mt-8 opacity-60"},ot={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200"},nt={class:"bg-card w-full max-w-sm rounded-xl shadow-2xl border p-6 animate-in zoom-in-95 duration-200"},rt={class:"flex items-center gap-4 mb-4 text-red-500"},at={class:"p-2 bg-red-100 dark:bg-red-500/10 rounded-full"},lt={class:"text-muted-foreground mb-6 text-sm leading-relaxed"},it={class:"flex justify-end"},P=1024*1024*1024,dt=pe({__name:"upload",setup(ut){const G=_(null),S=_(!1),U=_(!1),C=_(!1),I=_(null),Q=[{days:1800,unit:"seconds",label:"30m"},{days:1,unit:"days",label:"1d"},{days:3,unit:"days",label:"3d"},{days:7,unit:"days",label:"7d"},{days:30,unit:"days",label:"1mo"}],M=_(7),R=_("days"),x=_([]),b=_(null),W=V(()=>x.value.filter(r=>r.status==="done").length),ee=V(()=>{if(x.value.length===0)return 0;const r=x.value.reduce((t,n)=>t+n.progress,0);return Math.round(r/x.value.length)}),B=r=>{if(r===0)return"0 B";const t=1024,n=["B","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(t));return parseFloat((r/Math.pow(t,d)).toFixed(2))+" "+n[d]},te=r=>{var n;const t=(n=r.split(".").pop())==null?void 0:n.toLowerCase();return["png","jpg","jpeg","gif","webp"].includes(t||"")?"lucide:image":["pdf"].includes(t||"")?"lucide:file-text":["mp4","mov","avi","mkv"].includes(t||"")?"lucide:video":["zip","rar","7z"].includes(t||"")?"lucide:archive":["mp3","wav"].includes(t||"")?"lucide:music":"lucide:file"},se=r=>r.replace(/[^\x00-\xFF]/g,"_"),oe=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",ne=async r=>{var n;S.value=!1;const t=(n=r.dataTransfer)==null?void 0:n.files;t!=null&&t.length&&await q(Array.from(t))},re=async r=>{var n;const t=r.target;(n=t.files)!=null&&n.length&&await q(Array.from(t.files))},q=async r=>{var n;const t=r.reduce((d,s)=>d+s.size,0);if(t>P){I.value=`Total size (${B(t)}) exceeds limit of ${B(P)}`;return}x.value=r.map(d=>({file:d,status:"pending",progress:0})),U.value=!0;try{const d=await $fetch("/api/upload/allocate",{method:"POST",body:{files:r.map((o,p)=>({index:p,name:o.name,size:o.size}))}});console.log(`[Upload] Allocated to ${d.summary.accountsUsed} accounts:`,d.summary.distribution);const s=new Map;d.allocations.forEach(o=>{s.has(o.accountId)||s.set(o.accountId,{accountId:o.accountId,accountName:o.accountName,accessToken:o.accessToken,files:[]}),s.get(o.accountId).files.push({index:o.index,file:r[o.index]})});const T=8*1024*1024,ie=145*1024*1024,z=[];for(const[o,p]of s){const{accessToken:g,accountName:k}=p,y=`/Uploads/${Date.now()}_batch_${o.substring(0,8)}`;console.log(`[Upload] Uploading ${p.files.length} files to ${k}...`);for(const{index:a,file:u}of p.files){const h=x.value[a];h.status="uploading";const $=se(u.name),F=`${y}/${$}`;try{let v="";u.size>ie?v=await ue(h,g,F,T):v=await de(h,g,F),h.status="done",h.progress=100,h.path=v,z.push({name:u.name,path:v,size:u.size,accountId:o,accountName:k})}catch(v){h.status="error",console.error(`Failed to upload ${u.name}:`,v)}}}async function de(o,p,g){return new Promise((k,y)=>{const a=new XMLHttpRequest;a.upload.onprogress=u=>{u.lengthComputable&&(o.progress=Math.round(u.loaded/u.total*100))},a.onload=()=>{if(a.status>=200&&a.status<300)try{const u=JSON.parse(a.responseText);k(u.path_lower||u.path_display||g)}catch{k(g)}else y(new Error(`Upload failed: ${a.status}`))},a.onerror=()=>y(new Error("Network error")),a.open("POST","https://content.dropboxapi.com/2/files/upload"),a.setRequestHeader("Authorization",`Bearer ${p}`),a.setRequestHeader("Dropbox-API-Arg",JSON.stringify({path:g,mode:"add",autorename:!0,mute:!1})),a.setRequestHeader("Content-Type","application/octet-stream"),a.send(o.file)})}async function ue(o,p,g,k){const y=o.file.size;let a=0,u="",h=g;for(;a<y;){const $=o.file.slice(a,a+k),F=a+$.size>=y;await new Promise((v,H)=>{const l=new XMLHttpRequest;l.upload.onprogress=E=>{if(E.lengthComputable){const ce=a+E.loaded;o.progress=Math.round(ce/y*100)}},l.onload=()=>{if(l.status>=200&&l.status<300)try{const E=JSON.parse(l.responseText);a===0&&(u=E.session_id),F&&(h=E.path_lower||E.path_display||g),v()}catch{F?v():H(new Error("Failed to parse session ID"))}else H(new Error(`Chunk upload failed: ${l.status}`))},l.onerror=()=>H(new Error("Network error")),a===0?(l.open("POST","https://content.dropboxapi.com/2/files/upload_session/start"),l.setRequestHeader("Authorization",`Bearer ${p}`),l.setRequestHeader("Dropbox-API-Arg",JSON.stringify({close:!1})),l.setRequestHeader("Content-Type","application/octet-stream")):F?(l.open("POST","https://content.dropboxapi.com/2/files/upload_session/finish"),l.setRequestHeader("Authorization",`Bearer ${p}`),l.setRequestHeader("Dropbox-API-Arg",JSON.stringify({cursor:{session_id:u,offset:a},commit:{path:g,mode:"add",autorename:!0,mute:!1}})),l.setRequestHeader("Content-Type","application/octet-stream")):(l.open("POST","https://content.dropboxapi.com/2/files/upload_session/append_v2"),l.setRequestHeader("Authorization",`Bearer ${p}`),l.setRequestHeader("Dropbox-API-Arg",JSON.stringify({cursor:{session_id:u,offset:a},close:!1})),l.setRequestHeader("Content-Type","application/octet-stream")),l.send($)}),a+=$.size}return h}if(z.length===0)throw new Error("All uploads failed");const D=new Map;z.forEach(o=>{D.has(o.accountId)||D.set(o.accountId,[]),D.get(o.accountId).push(o)});const L=z[0].accountId,ct=D.get(L),J=await $fetch("/api/anonymous/complete",{method:"POST",body:{accountId:L,folderPath:`/Uploads/${Date.now()}_batch`,files:z.map(o=>({name:o.name,path:o.path,size:o.size,accountId:o.accountId})),expirationDays:M.value,expirationUnit:R.value}});b.value={url:J.share.url,fileCount:z.length,expiresAt:J.share.expiresAt}}catch(d){console.error("Upload error:",d),I.value=((n=d.data)==null?void 0:n.statusMessage)||d.message||"Upload failed"}finally{U.value=!1}},ae=async()=>{b.value&&(await navigator.clipboard.writeText(b.value.url),C.value=!0,setTimeout(()=>C.value=!1,2e3))},le=()=>{b.value=null,x.value=[]};return(r,t)=>{const n=ge,d=ve;return c(),w("div",_e,[t[15]||(t[15]=e("div",{class:"absolute inset-0 z-0 pointer-events-none"},[e("div",{class:"absolute top-[-20%] left-[-10%] w-[600px] h-[600px] bg-[#0061FE]/10 rounded-full blur-[100px]"}),e("div",{class:"absolute bottom-[-20%] right-[-10%] w-[500px] h-[500px] bg-purple-500/10 rounded-full blur-[100px]"})],-1)),e("header",we,[m(d,{to:"/",class:"flex items-center gap-2.5 font-semibold text-xl tracking-tight hover:opacity-80 transition-opacity"},{default:me(()=>[e("div",ye,[m(n,{name:"lucide:hard-drive",class:"h-5 w-5"})]),t[5]||(t[5]=e("span",{class:"text-foreground"},"MultiBox",-1))]),_:1})]),e("main",ke,[e("div",Ee,[!i(b)&&!i(U)?(c(),w("div",ze,[t[8]||(t[8]=e("div",{class:"text-center space-y-3 mb-10"},[e("h1",{class:"text-3xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-foreground to-foreground/70"}," Upload & Share "),e("p",{class:"text-muted-foreground text-lg"}," Secure anonymous file sharing. ")],-1)),e("div",{onDragover:t[0]||(t[0]=O(s=>S.value=!0,["prevent"])),onDragleave:t[1]||(t[1]=O(s=>S.value=!1,["prevent"])),onDrop:O(ne,["prevent"]),class:A(["group relative border-2 border-dashed rounded-2xl p-12 text-center transition-all duration-300 cursor-pointer",i(S)?"border-[#0061FE] bg-[#0061FE]/5 scale-[1.02]":"border-muted-foreground/20 hover:border-[#0061FE]/50 hover:bg-muted/30"]),onClick:t[2]||(t[2]=s=>r.$refs.fileInput.click())},[e("input",{type:"file",ref_key:"fileInput",ref:G,onChange:re,class:"hidden",multiple:""},null,544),e("div",Fe,[e("div",Ce,[m(n,{name:"lucide:cloud-upload",class:"h-8 w-8 transition-transform duration-300 group-hover:scale-110"})]),e("div",Ie,[t[6]||(t[6]=e("p",{class:"font-semibold text-lg"},"Click to browse or drag files here",-1)),e("p",$e,"Up to "+f(B(P))+" total",1)])])],34),e("div",Ae,[e("div",Se,[m(n,{name:"lucide:clock",class:"h-4 w-4 text-muted-foreground"}),t[7]||(t[7]=e("span",{class:"text-xs font-semibold text-muted-foreground uppercase tracking-wider"},"Auto-Expire In",-1))]),e("div",Ue,[(c(),w(Y,null,K(Q,s=>e("button",{key:s.label,onClick:T=>{M.value=s.days,R.value=s.unit},class:A(["px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 border",i(M)===s.days&&i(R)===s.unit?"bg-[#0061FE] text-white border-[#0061FE] shadow-md shadow-blue-500/20":"bg-background hover:bg-muted border-border hover:border-foreground/20 text-muted-foreground hover:text-foreground"])},f(s.label),11,Te)),64))])])])):i(U)?(c(),w("div",De,[e("div",Me,[e("div",Re,[m(n,{name:"lucide:loader-2",class:"h-6 w-6 animate-spin"}),t[9]||(t[9]=e("span",{class:"text-xl font-semibold"},"Uploading...",-1))]),e("p",Be,f(i(W))+" of "+f(i(x).length)+" files uploaded",1)]),e("div",He,[e("div",{class:"bg-[#0061FE] h-full transition-all duration-300 ease-out rounded-full",style:Z({width:`${i(ee)}%`})},null,4)]),e("div",Ne,[(c(!0),w(Y,null,K(i(x),(s,T)=>(c(),w("div",{key:T,class:A(["flex items-center gap-4 p-3 rounded-xl bg-muted/30 border border-transparent",{"border-red-500/20 bg-red-500/5":s.status==="error"}])},[e("div",Oe,[m(n,{name:te(s.file.name),class:"h-5 w-5 text-muted-foreground"},null,8,["name"])]),e("div",je,[e("div",Pe,[e("span",qe,f(s.file.name),1),e("span",Le,f(s.status==="uploading"?`${s.progress}%`:s.status==="done"?"Done":s.status==="error"?"Failed":"Pending"),1)]),e("div",Je,[e("div",{class:A(["h-full transition-all duration-300",[s.status==="done"?"bg-green-500":s.status==="error"?"bg-red-500":"bg-[#0061FE]"]]),style:Z({width:`${s.progress}%`})},null,6)])]),e("div",Ve,[s.status==="done"?(c(),N(n,{key:0,name:"lucide:check-circle-2",class:"h-5 w-5 text-green-500"})):s.status==="error"?(c(),N(n,{key:1,name:"lucide:alert-circle",class:"h-5 w-5 text-red-500"})):he((c(),w("div",Xe,null,512)),[[xe,s.status==="uploading"]])])],2))),128))])])):i(b)?(c(),w("div",Ye,[e("div",Ke,[m(n,{name:"lucide:check",class:"h-10 w-10"})]),t[12]||(t[12]=e("h2",{class:"text-2xl font-bold mb-2"},"Upload Complete!",-1)),t[13]||(t[13]=e("p",{class:"text-muted-foreground mb-8"},"Your files are ready to share.",-1)),e("div",Ze,[e("div",Ge,[e("div",Qe,[m(n,{name:"lucide:link-2",class:"h-5 w-5"})]),e("input",{type:"text",value:i(b).url,readonly:"",class:"flex-1 bg-transparent border-none focus:ring-0 font-mono text-sm text-foreground overflow-ellipsis",onClick:t[3]||(t[3]=s=>s.target.select())},null,8,We),e("button",{onClick:ae,class:A(["h-10 px-5 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 text-sm",[i(C)?"bg-green-500 text-white shadow-lg shadow-green-500/20":"bg-[#0061FE] text-white hover:bg-[#0057E5] shadow-lg shadow-blue-500/20"]])},[m(n,{name:i(C)?"lucide:check":"lucide:copy",class:"h-4 w-4"},null,8,["name"]),j(" "+f(i(C)?"Copied":"Copy"),1)],2)]),e("div",et,[e("span",null,[t[10]||(t[10]=j("Expires: ",-1)),e("span",tt,f(oe(i(b).expiresAt)),1)]),e("span",null,f(i(b).fileCount)+" files",1)])]),e("button",{onClick:le,class:"text-sm font-medium text-muted-foreground hover:text-foreground transition-colors flex items-center justify-center gap-2 mx-auto"},[m(n,{name:"lucide:refresh-ccw",class:"h-3 w-3"}),t[11]||(t[11]=j(" Upload more files ",-1))])])):X("",!0)]),e("p",st," Â© "+f(new Date().getFullYear())+" MultiBox. Secure, fast, and anonymous file sharing. ",1)]),(c(),N(fe,{to:"body"},[i(I)?(c(),w("div",ot,[e("div",nt,[e("div",rt,[e("div",at,[m(n,{name:"lucide:alert-triangle",class:"h-6 w-6"})]),t[14]||(t[14]=e("h3",{class:"font-semibold text-lg text-foreground"},"Upload Error",-1))]),e("p",lt,f(i(I)),1),e("div",it,[e("button",{onClick:t[4]||(t[4]=s=>I.value=null),class:"px-4 py-2 bg-background border hover:bg-muted text-foreground rounded-lg text-sm font-medium transition-colors"}," Close ")])])])):X("",!0)]))])}}}),ft=be(dt,[["__scopeId","data-v-ac632bb8"]]);export{ft as default};
