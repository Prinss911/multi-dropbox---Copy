import{d as te,r as f,g as se,h as oe,i as ne,c as r,a as e,j as A,t as u,f as n,b as d,w as N,F as le,k as ie,l as h,m as E,e as a,_ as de,T as V,n as R,v as K,p as L,q as re,o as i,s as Y,x as ae}from"./D0_loxAU.js";import{_ as ue}from"./2t6NhyjD.js";import{u as ce,a as me}from"./DfhhxIwp.js";import"./oVxJKGu7.js";import"./BNf5BS2b.js";import"./CxRmHzWs.js";const fe={class:"h-full flex flex-col bg-background/50"},xe={class:"sticky top-0 z-20 bg-background/95 backdrop-blur border-b px-6 py-4"},ge={class:"w-full"},pe={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},be={class:"text-sm text-muted-foreground"},he={class:"flex items-center gap-6"},ve={class:"hidden md:flex items-center gap-3"},we={class:"h-10 w-10 rounded-full bg-blue-50 flex items-center justify-center text-[#0061FE]"},ye={class:"text-right sm:text-left"},_e={class:"text-sm font-semibold text-[#1E1919] dark:text-foreground"},ke={class:"text-xs text-muted-foreground"},Ae={class:"flex-1 overflow-auto px-4 md:px-6 py-8 transition-all"},Ee={class:"w-full"},Ce={key:0,class:"flex flex-col items-center justify-center py-20 text-muted-foreground"},Fe={key:1,class:"flex flex-col items-center justify-center py-20 text-center border-2 border-dashed rounded-xl bg-muted/10"},je={class:"h-24 w-24 mb-4 flex items-center justify-center rounded-full bg-blue-50 text-[#0061FE]"},De={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-6"},Me=["onClick"],Be={key:0,class:"absolute top-4 right-4"},ze={class:"flex items-start gap-4 mb-6"},Te={class:"h-12 w-12 rounded-xl bg-[#0061FE]/5 flex items-center justify-center shrink-0"},Ue={class:"min-w-0 pr-12"},Se=["title"],Pe=["title"],$e={class:"mb-6"},Ne={class:"flex items-end justify-between mb-2"},Ve={class:"text-2xl font-bold block text-[#1E1919] dark:text-foreground"},Re={class:"text-right text-xs text-muted-foreground"},Ke={class:"font-medium text-foreground"},Le={class:"h-2 w-full bg-muted/50 rounded-full overflow-hidden"},Ye={class:"flex items-center justify-between pt-4 border-t border-dashed"},qe={class:"text-xs text-muted-foreground"},Ge={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Ie=["onClick"],Oe=["onClick"],We={class:"bg-card w-full max-w-[400px] rounded-xl shadow-2xl border-0 overflow-hidden animate-in fade-in zoom-in-95 duration-200 p-6"},He={class:"flex flex-col items-center text-center gap-4"},Je={class:"h-12 w-12 rounded-full bg-red-50 flex items-center justify-center text-red-600 mb-2"},Qe={class:"text-sm text-muted-foreground mt-2 px-4"},Xe={class:"font-medium text-foreground"},Ze={class:"flex gap-3 w-full mt-4"},et=["disabled"],tt={class:"bg-card w-full max-w-[480px] rounded-xl shadow-2xl border-0 overflow-hidden animate-in fade-in zoom-in-95 duration-200"},st={class:"px-6 py-5 border-b bg-background flex items-center justify-between"},ot={class:"font-semibold text-lg text-[#1E1919] dark:text-foreground flex items-center gap-2"},nt={class:"p-6"},lt={key:0,class:"space-y-6"},it={class:"space-y-4"},dt={class:"space-y-1.5"},rt={class:"space-y-1.5"},at=["disabled"],ut={key:1},ct={key:1,class:"text-center py-8"},mt={class:"h-16 w-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4 animate-in zoom-in duration-300"},ft={key:2,class:"text-center py-6"},xt={class:"h-14 w-14 rounded-full bg-red-100 flex items-center justify-center mx-auto mb-4"},gt={class:"text-muted-foreground text-sm mb-6"},kt=te({__name:"accounts",setup(pt){const{accounts:p,activeAccountId:D,isLoading:q,isAddingAccount:M,fetchAccounts:G,switchAccount:B,getAuthUrl:I,addAccount:O,removeAccount:W}=ce(),{fetchFiles:C}=me(),z=re(),w=f(null),y=async()=>{try{const s=await $fetch("/api/dropbox/storage-all");w.value=s}catch(s){console.error("Error fetching storage:",s)}},H=se(()=>p.value.map(s=>{var l;const t=(l=w.value)==null?void 0:l.accounts.find(g=>g.accountId===s.id);return{...s,used:(t==null?void 0:t.used)??null,total:(t==null?void 0:t.total)??null,storagePercent:t&&t.total>0?t.used/t.total*100:null}})),c=f(null),v=f(!1),J=s=>{c.value=s},Q=async()=>{if(c.value){v.value=!0;try{const s=D.value===c.value.id;await W(c.value.id)&&(c.value=null,await y(),s&&p.value.length>0&&(await B(p.value[0].id),await C("",!0)))}finally{v.value=!1}}},F=f(!1),m=f("auth"),_=f(""),x=f(""),b=f(""),T=()=>{F.value=!0,m.value="auth",x.value="",b.value="",_.value=""},j=()=>{F.value=!1,m.value="auth",x.value="",b.value="",_.value=""},X=()=>{const s=z.public.dropboxAppKey;typeof window<"u"&&window.open(I(s),"_blank","width=600,height=800")},Z=async()=>{const s=z.public.dropboxAppKey,t=await O(x.value,s,"",b.value||void 0);t.success?(m.value="success",await y(),await C("")):(_.value=t.error||"Failed to add account",m.value="error")},U=async s=>{D.value!==s&&(await B(s),await C("",!0))},k=s=>{if(!s||s===0)return"0 B";const t=1024,l=["B","KB","MB","GB","TB"],g=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,g)).toFixed(2))+" "+l[g]},ee=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Unknown";return oe(()=>{G(),y()}),ne(p,()=>{y()},{deep:!0}),(s,t)=>{var S,P;const l=de,g=ue;return i(),r("div",fe,[e("div",xe,[e("div",ge,[e("div",pe,[e("div",null,[t[5]||(t[5]=e("h1",{class:"text-xl font-semibold text-[#1E1919] dark:text-foreground"},"Connected Accounts",-1)),e("p",be,u(n(p).length)+" active connections",1)]),e("div",he,[e("div",ve,[e("div",we,[d(l,{name:"lucide:hard-drive",class:"h-5 w-5"})]),e("div",ye,[e("p",_e,u(k(((S=n(w))==null?void 0:S.totalUsed)||0))+" used ",1),e("p",ke," of "+u(k(((P=n(w))==null?void 0:P.totalAllocated)||0))+" total ",1)])]),t[7]||(t[7]=e("div",{class:"w-px h-8 bg-border hidden md:block"},null,-1)),d(g,{onClick:T,class:"bg-[#0061FE] hover:bg-[#0057E5] text-white"},{default:N(()=>[d(l,{name:"lucide:plus",class:"h-4 w-4 mr-2"}),t[6]||(t[6]=a(" Connect New Account ",-1))]),_:1})])])])]),e("div",Ae,[e("div",Ee,[n(q)?(i(),r("div",Ce,[d(l,{name:"lucide:loader-2",class:"animate-spin h-8 w-8 text-[#0061FE] mb-4"}),t[8]||(t[8]=e("p",{class:"text-sm"},"Fetching metrics...",-1))])):n(p).length===0?(i(),r("div",Fe,[e("div",je,[d(l,{name:"simple-icons:dropbox",class:"h-10 w-10"})]),t[10]||(t[10]=e("h3",{class:"text-lg font-semibold text-[#1E1919] dark:text-foreground mb-2"},"No accounts connected",-1)),t[11]||(t[11]=e("p",{class:"text-muted-foreground text-sm max-w-sm mb-6"}," Connect your Dropbox accounts to start pooling your storage space and managing files centrally. ",-1)),d(g,{onClick:T,size:"lg",class:"bg-[#0061FE] hover:bg-[#0057E5] text-white"},{default:N(()=>[...t[9]||(t[9]=[a(" Connect First Account ",-1)])]),_:1})])):(i(),r("div",De,[(i(!0),r(le,null,ie(n(H),o=>(i(),r("div",{key:o.id,class:Y(["group relative bg-card hover:bg-muted/20 border rounded-xl p-5 transition-all shadow-sm hover:shadow-md",{"ring-2 ring-[#0061FE] ring-offset-2 dark:ring-offset-background":o.isActive}]),onClick:$=>U(o.id)},[o.isActive?(i(),r("div",Be,[...t[12]||(t[12]=[e("span",{class:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-[#0061FE]/10 text-[#0061FE] text-xs font-bold uppercase tracking-wider"}," Active ",-1)])])):h("",!0),e("div",ze,[e("div",Te,[d(l,{name:"simple-icons:dropbox",class:"h-6 w-6 text-[#0061FE]"})]),e("div",Ue,[e("h3",{class:"font-semibold text-base truncate text-[#1E1919] dark:text-foreground",title:o.name},u(o.name),9,Se),e("p",{class:"text-sm text-muted-foreground truncate",title:o.email||""},u(o.email||"No email"),9,Pe)])]),e("div",$e,[e("div",Ne,[e("div",null,[e("span",Ve,u(o.storagePercent!==null?Math.round(o.storagePercent):0)+"%",1),t[13]||(t[13]=e("span",{class:"text-xs text-muted-foreground font-medium uppercase tracking-wide"},"Usage",-1))]),e("div",Re,[e("p",null,[e("span",Ke,u(k(o.used||0)),1),t[14]||(t[14]=a(" used",-1))]),e("p",null,"of "+u(k(o.total||0)),1)])]),e("div",Le,[e("div",{class:Y(["h-full rounded-full transition-all duration-700 ease-out",[o.storagePercent>90?"bg-red-500":o.storagePercent>75?"bg-amber-500":"bg-[#0061FE]"]]),style:ae({width:`${Math.min(o.storagePercent||0,100)}%`})},null,6)])]),e("div",Ye,[e("span",qe," Added "+u(ee(o.createdAt)),1),e("div",Ge,[o.isActive?h("",!0):(i(),r("button",{key:0,onClick:E($=>U(o.id),["stop"]),class:"p-2 h-8 w-8 flex items-center justify-center rounded hover:bg-muted text-muted-foreground hover:text-[#0061FE] transition-colors",title:"Switch to this account"},[d(l,{name:"lucide:arrow-right-left",class:"h-4 w-4"})],8,Ie)),e("button",{onClick:E($=>J(o),["stop"]),class:"p-2 h-8 w-8 flex items-center justify-center rounded hover:bg-red-50 text-muted-foreground hover:text-red-600 transition-colors",title:"Remove account"},[d(l,{name:"lucide:trash-2",class:"h-4 w-4"})],8,Oe)])])],10,Me))),128))]))])]),(i(),A(V,{to:"body"},[n(c)?(i(),r("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-[#1E1919]/60 backdrop-blur-[2px]",onClick:t[1]||(t[1]=E(o=>c.value=null,["self"]))},[e("div",We,[e("div",He,[e("div",Je,[d(l,{name:"lucide:alert-triangle",class:"h-6 w-6"})]),e("div",null,[t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-[#1E1919] dark:text-foreground"},"Remove Account?",-1)),e("p",Qe,[t[15]||(t[15]=a(" Are you sure you want to remove ",-1)),e("span",Xe,u(n(c).name),1),t[16]||(t[16]=a("? ",-1)),t[17]||(t[17]=e("br",null,null,-1)),t[18]||(t[18]=a("This will disconnect it from MultiBox. Your files on Dropbox will remain safe. ",-1))])]),e("div",Ze,[e("button",{onClick:t[0]||(t[0]=o=>c.value=null),class:"flex-1 h-10 rounded-lg border hover:bg-muted transition-colors text-sm font-medium"}," Cancel "),e("button",{onClick:Q,disabled:n(v),class:"flex-1 h-10 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors text-sm font-medium flex items-center justify-center gap-2 disabled:opacity-70"},[n(v)?(i(),A(l,{key:0,name:"lucide:loader-2",class:"h-4 w-4 animate-spin"})):h("",!0),a(" "+u(n(v)?"Removing...":"Remove"),1)],8,et)])])])])):h("",!0)])),(i(),A(V,{to:"body"},[n(F)?(i(),r("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-[#1E1919]/60 backdrop-blur-[2px]",onClick:E(j,["self"])},[e("div",tt,[e("div",st,[e("h3",ot,[d(l,{name:"simple-icons:dropbox",class:"h-5 w-5 text-[#0061FE]"}),t[20]||(t[20]=a(" Connect Dropbox ",-1))]),e("button",{onClick:j,class:"p-1 rounded-full hover:bg-muted text-muted-foreground transition-colors"},[d(l,{name:"lucide:x",class:"h-5 w-5"})])]),e("div",nt,[n(m)==="auth"?(i(),r("div",lt,[t[24]||(t[24]=e("div",{class:"p-4 bg-muted/20 rounded-lg border border-dashed text-sm text-muted-foreground"},[e("p",{class:"mb-2 font-medium text-foreground"},"Instructions:"),e("ol",{class:"list-decimal pl-4 space-y-1"},[e("li",null,[a("Click "),e("strong",null,"Authorize"),a(" below to open Dropbox login.")]),e("li",null,"Allow access to MultiBox app."),e("li",null,[a("Copy the generated "),e("strong",null,"Access Code"),a(".")]),e("li",null,"Paste the code in the field below.")])],-1)),e("button",{onClick:X,class:"w-full h-11 rounded-lg border-2 border-[#0061FE] text-[#0061FE] hover:bg-[#0061FE]/5 font-semibold text-sm transition-all flex items-center justify-center gap-2"},[t[21]||(t[21]=a(" Authorize with Dropbox ",-1)),d(l,{name:"lucide:external-link",class:"h-4 w-4"})]),t[25]||(t[25]=e("div",{class:"relative py-2"},[e("div",{class:"absolute inset-0 flex items-center"},[e("span",{class:"w-full border-t"})]),e("div",{class:"relative flex justify-center text-xs uppercase tracking-wider font-semibold"},[e("span",{class:"bg-card px-3 text-muted-foreground"},"Verification")])],-1)),e("div",it,[e("div",dt,[t[22]||(t[22]=e("label",{class:"text-xs font-semibold uppercase text-muted-foreground"},"Access Code",-1)),R(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>L(x)?x.value=o:null),placeholder:"Paste the code here...",class:"w-full h-10 px-3 rounded-lg border bg-background focus:ring-2 focus:ring-[#0061FE]/20 focus:border-[#0061FE] transition-all font-mono text-sm"},null,512),[[K,n(x)]])]),e("div",rt,[t[23]||(t[23]=e("label",{class:"text-xs font-semibold uppercase text-muted-foreground"},"Account Alias (Optional)",-1)),R(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>L(b)?b.value=o:null),placeholder:"e.g. 'Personal' or 'Design Team'",class:"w-full h-10 px-3 rounded-lg border bg-background focus:ring-2 focus:ring-[#0061FE]/20 focus:border-[#0061FE] transition-all text-sm"},null,512),[[K,n(b)]])])]),e("button",{onClick:Z,disabled:!n(x)||n(M),class:"w-full h-11 mt-2 rounded-lg bg-[#0061FE] hover:bg-[#0057E5] text-white font-semibold text-sm shadow-sm transition-all flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed"},[n(M)?(i(),A(l,{key:0,name:"lucide:loader-2",class:"h-5 w-5 animate-spin"})):(i(),r("span",ut,"Connect Account"))],8,at)])):n(m)==="success"?(i(),r("div",ct,[e("div",mt,[d(l,{name:"lucide:check",class:"h-8 w-8 text-green-600"})]),t[26]||(t[26]=e("h3",{class:"text-xl font-bold text-[#1E1919] dark:text-foreground mb-2"},"Account Connected!",-1)),t[27]||(t[27]=e("p",{class:"text-muted-foreground mb-8"}," Your Dropbox account has been successfully linked. ",-1)),e("button",{onClick:j,class:"w-full h-11 rounded-lg bg-[#0061FE] hover:bg-[#0057E5] text-white font-semibold text-sm transition-all"}," Done ")])):n(m)==="error"?(i(),r("div",ft,[e("div",xt,[d(l,{name:"lucide:x",class:"h-7 w-7 text-red-600"})]),t[28]||(t[28]=e("h3",{class:"text-lg font-bold text-red-600 mb-2"},"Connection Failed",-1)),e("p",gt,u(n(_)),1),e("button",{onClick:t[4]||(t[4]=o=>m.value="auth"),class:"w-full h-11 rounded-lg border hover:bg-muted font-semibold text-sm transition-all"}," Try Again ")])):h("",!0)])])])):h("",!0)]))])}}});export{kt as default};
