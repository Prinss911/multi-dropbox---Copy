import{d as S,I as T,r as c,g as p,h as C,c as i,l as g,f as s,b as d,a,t as V,j as E,e as P,o,_ as U}from"./D0_loxAU.js";import{_ as z}from"./BRF61fbF.js";import"./P7PFuRdT.js";import"./B5rdlIOA.js";import"./oVxJKGu7.js";const M={class:"h-screen w-screen bg-black overflow-hidden relative font-sans"},R={key:0,class:"absolute inset-0 flex flex-col items-center justify-center text-white z-50 bg-black"},q={key:1,class:"absolute inset-0 flex flex-col items-center justify-center text-white z-50 bg-black p-4 text-center"},A={class:"w-16 h-16 bg-red-900/30 rounded-full flex items-center justify-center mb-4"},D={class:"text-gray-400 max-w-md"},O={key:2,class:"w-full h-full"},G={key:0,class:"w-full h-full relative group"},H={key:0,class:"absolute inset-0 z-40 flex items-center justify-center bg-black/80 backdrop-blur-sm text-white"},J={key:1,class:"w-full h-full flex flex-col items-center justify-center bg-gray-900 text-white p-8"},K={class:"w-32 h-32 bg-indigo-500/20 rounded-full flex items-center justify-center mb-8 animate-pulse"},Q={class:"text-xl font-bold mb-8 text-center px-4"},W=["src"],X={key:2,class:"w-full h-full flex flex-col items-center justify-center bg-gray-900 text-white"},Y=["href"],ie=S({__name:"[id]",setup(Z){const m=T().params.id,$=["mp4","webm","mkv","avi","mov"],I=["mp3","wav","ogg","flac","m4a"],h=t=>{var e;return((e=t.split(".").pop())==null?void 0:e.toLowerCase())||""},f=c(null),x=c(!0),v=c(null),b=c(!1),u=c(""),n=c("video/mp4"),r=p(()=>{var t;return((t=f.value)==null?void 0:t.files)||[]}),k=p(()=>r.value.length>1),w=p(()=>r.value.length!==1?!1:$.includes(h(r.value[0].name))),B=p(()=>r.value.length!==1?!1:I.includes(h(r.value[0].name))),_=t=>`/api/shares/${m}/stream?fileIndex=${t}`,F=async()=>{if(!w.value||k.value||!r.value.length)return;const t=r.value[0],e=h(t.name);u.value="",b.value=!0;try{if(["mkv","mp4","mov"].includes(e)){n.value="application/x-mpegURL";const l=await $fetch(`/api/shares/${m}/transcode`,{query:{fileIndex:0}}),y="/api/proxy/hls?url=";u.value=y+encodeURIComponent(l.url)}else e==="webm"?n.value="video/webm":e==="avi"?n.value="video/x-msvideo":n.value="video/mp4",u.value=_(0)}catch(l){console.error("Failed to prepare stream:",l),n.value="video/mp4",e==="webm"&&(n.value="video/webm"),u.value=_(0)}finally{b.value=!1}},N=async()=>{var t;x.value=!0,v.value=null;try{const e=await $fetch(`/api/shares/${m}/download`);f.value=e,L(),w.value&&!k.value&&await F()}catch(e){v.value=((t=e.data)==null?void 0:t.message)||e.message||"Failed to load file"}finally{x.value=!1}},j=c(!1),L=async()=>{if(!j.value){j.value=!0;try{await $fetch(`/api/shares/${m}/view`,{method:"POST"})}catch(t){console.warn("Failed to track view:",t)}}};return C(()=>{N()}),(t,e)=>{const l=U,y=z;return o(),i("div",M,[s(x)?(o(),i("div",R,[d(l,{name:"lucide:loader-2",class:"w-10 h-10 animate-spin mb-4 text-blue-500"}),e[0]||(e[0]=a("p",{class:"text-sm text-gray-400"},"Loading media...",-1))])):s(v)?(o(),i("div",q,[a("div",A,[d(l,{name:"lucide:alert-circle",class:"w-8 h-8 text-red-500"})]),e[1]||(e[1]=a("h3",{class:"text-lg font-bold mb-2"},"Media Unavailable",-1)),a("p",D,V(s(v)),1)])):s(f)?(o(),i("div",O,[s(w)?(o(),i("div",G,[s(b)?(o(),i("div",H,[d(l,{name:"lucide:loader-2",class:"w-10 h-10 animate-spin text-blue-500"}),e[2]||(e[2]=a("span",{class:"ml-3 font-medium"},"Preparing stream...",-1))])):g("",!0),s(u)?(o(),E(y,{key:1,src:s(u),type:s(n),title:s(f).fileName,class:"w-full h-full [&>.video-js]:w-full [&>.video-js]:h-full",autoplay:""},null,8,["src","type","title"])):g("",!0)])):s(B)?(o(),i("div",J,[a("div",K,[d(l,{name:"lucide:music",class:"w-16 h-16 text-indigo-400"})]),a("h1",Q,V(s(f).fileName),1),a("audio",{src:_(0),controls:"",class:"w-full max-w-md",autoplay:""},null,8,W)])):(o(),i("div",X,[d(l,{name:"lucide:file-question",class:"w-16 h-16 text-gray-500 mb-4"}),e[4]||(e[4]=a("p",{class:"text-lg mb-4"},"This file type cannot be embedded.",-1)),a("a",{href:`/file/${s(m)}`,target:"_blank",class:"px-6 py-2 bg-blue-600 rounded-full text-sm hover:bg-blue-700 transition flex items-center"},[d(l,{name:"lucide:external-link",class:"w-4 h-4 mr-2"}),e[3]||(e[3]=P(" View File Page ",-1))],8,Y)]))])):g("",!0)])}}});export{ie as default};
