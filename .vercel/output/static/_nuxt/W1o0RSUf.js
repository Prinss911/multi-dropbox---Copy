import{d as B,B as L,u as T,I as $,r as l,h as j,c as p,a as t,f as s,b as n,t as A,w as E,F as I,l as V,m as R,p as N,s as F,e as C,_ as M,o as d,A as O,j as H}from"./D0_loxAU.js";import{_ as z}from"./2t6NhyjD.js";import{_ as D}from"./CXcBp2lP.js";import"./oVxJKGu7.js";import"./BNf5BS2b.js";import"./B5rdlIOA.js";const Q={class:"min-h-screen bg-muted/30 flex items-center justify-center p-4"},G={class:"w-full max-w-md space-y-8 bg-card p-8 rounded-xl border shadow-sm"},J={key:0,class:"text-center space-y-4"},K={class:"h-10 w-10 bg-primary/10 text-primary rounded-full flex items-center justify-center mx-auto"},W={key:1,class:"text-center space-y-4"},X={class:"h-12 w-12 bg-destructive/10 text-destructive rounded-full flex items-center justify-center mx-auto"},Y={class:"text-sm text-muted-foreground"},Z={class:"text-center space-y-2"},ee={class:"h-10 w-10 bg-primary/10 text-primary rounded-full flex items-center justify-center mx-auto mb-4"},se={class:"space-y-2"},te={class:"relative"},oe={class:"space-y-2"},re={class:"relative"},ae={key:0,class:"text-xs text-destructive mt-1 flex items-center gap-1"},ne={key:0,class:"p-3 text-sm text-destructive bg-destructive/10 rounded-md flex items-center gap-2"},pe=B({__name:"confirm",setup(le){const w=L(),U=T(),v=$(),c=l(""),h=l(""),x=l(!1),_=l(!1),m=l(!1),y=l(!0),k=l(!1),i=l(""),b=l(""),u=l(""),S=(r=!1)=>r&&!h.value?(u.value="",!1):c.value!==h.value?(u.value="Passwords don't match",!1):c.value.length<8?(r||(u.value="Password must be at least 8 characters"),!1):(u.value="",!0),q=async()=>{if(S()){m.value=!0,b.value="";try{const{error:r}=await w.auth.updateUser({password:c.value});if(r)throw r;U.push("/")}catch(r){console.error("Update password error:",r),b.value=r.message||"Failed to set password"}finally{m.value=!1}}};return j(async()=>{if(console.log("[AuthConfirm] Mounted, checking URL params..."),console.log("[AuthConfirm] Hash:",window.location.hash),console.log("[AuthConfirm] Query:",v.query),v.query.error){i.value=v.query.error_description||"Invalid or expired link",y.value=!1;return}const r=v.query.token_hash,e=v.query.type,a=new URLSearchParams(window.location.hash.substring(1)),f=a.get("access_token"),g=a.get("refresh_token");console.log("[AuthConfirm] token_hash:",!!r,"type:",e),console.log("[AuthConfirm] access_token in hash:",!!f);try{if(r&&e){console.log("[AuthConfirm] Verifying token_hash with type:",e);const{data:o,error:P}=await w.auth.verifyOtp({token_hash:r,type:e});if(P){console.error("[AuthConfirm] verifyOtp error:",P),i.value=P.message||"Link expired or invalid",y.value=!1;return}o.session&&(console.log("[AuthConfirm] Session established via verifyOtp"),k.value=!0)}else if(f&&g){console.log("[AuthConfirm] Setting session from hash tokens");const{error:o}=await w.auth.setSession({access_token:f,refresh_token:g});if(o){console.error("[AuthConfirm] setSession error:",o),i.value=o.message||"Failed to establish session",y.value=!1;return}k.value=!0}else{console.log("[AuthConfirm] No token params, checking existing session...");const{data:{session:o}}=await w.auth.getSession();o?(console.log("[AuthConfirm] Existing session found"),k.value=!0):(console.log("[AuthConfirm] No session found"),i.value="No valid session. Please use your invite link from email.")}}catch(o){console.error("[AuthConfirm] Error during verification:",o),i.value=o.message||"Verification failed"}finally{y.value=!1}}),(r,e)=>{const a=M,f=z,g=D;return d(),p("div",Q,[t("div",G,[s(y)?(d(),p("div",J,[t("div",K,[n(a,{name:"lucide:loader-2",class:"h-5 w-5 animate-spin"})]),e[6]||(e[6]=t("p",{class:"text-muted-foreground"},"Verifying your link...",-1))])):s(i)&&!s(k)?(d(),p("div",W,[t("div",X,[n(a,{name:"lucide:x-circle",class:"h-6 w-6"})]),e[8]||(e[8]=t("h1",{class:"text-xl font-semibold"},"Link Invalid",-1)),t("p",Y,A(s(i)),1),n(f,{onClick:e[0]||(e[0]=o=>("navigateTo"in r?r.navigateTo:s(O))("/login")),variant:"outline",class:"mt-4"},{default:E(()=>[n(a,{name:"lucide:arrow-left",class:"mr-2 h-4 w-4"}),e[7]||(e[7]=C(" Back to Login ",-1))]),_:1})])):(d(),p(I,{key:2},[t("div",Z,[t("div",ee,[n(a,{name:"lucide:key",class:"h-5 w-5"})]),e[9]||(e[9]=t("h1",{class:"text-2xl font-semibold tracking-tight"},"Set Password",-1)),e[10]||(e[10]=t("p",{class:"text-sm text-muted-foreground"},"Please set a secure password to complete your account setup.",-1))]),t("form",{onSubmit:R(q,["prevent"]),class:"space-y-4"},[t("div",se,[e[11]||(e[11]=t("label",{class:"text-sm font-medium leading-none",for:"password"}," New Password ",-1)),t("div",te,[n(g,{id:"password",modelValue:s(c),"onUpdate:modelValue":e[1]||(e[1]=o=>N(c)?c.value=o:null),type:s(x)?"text":"password",required:"",minlength:"8",placeholder:"••••••••",disabled:s(m),class:"pr-10"},null,8,["modelValue","type","disabled"]),t("button",{type:"button",onClick:e[2]||(e[2]=o=>x.value=!s(x)),class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"},[n(a,{name:s(x)?"lucide:eye-off":"lucide:eye",class:"h-4 w-4"},null,8,["name"])])])]),t("div",oe,[e[12]||(e[12]=t("label",{class:"text-sm font-medium leading-none",for:"confirmPassword"}," Confirm Password ",-1)),t("div",re,[n(g,{id:"confirmPassword",modelValue:s(h),"onUpdate:modelValue":e[3]||(e[3]=o=>N(h)?h.value=o:null),type:s(_)?"text":"password",required:"",minlength:"8",placeholder:"••••••••",disabled:s(m),class:F("pr-10 "+(s(u)?"border-destructive focus-visible:ring-destructive":"")),onInput:e[4]||(e[4]=o=>S(!0))},null,8,["modelValue","type","disabled","class"]),t("button",{type:"button",onClick:e[5]||(e[5]=o=>_.value=!s(_)),class:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"},[n(a,{name:s(_)?"lucide:eye-off":"lucide:eye",class:"h-4 w-4"},null,8,["name"])])]),s(u)?(d(),p("p",ae,[n(a,{name:"lucide:alert-circle",class:"h-3 w-3"}),C(" "+A(s(u)),1)])):V("",!0)]),n(f,{class:"w-full",type:"submit",disabled:s(m)},{default:E(()=>[s(m)?(d(),H(a,{key:0,name:"lucide:loader-2",class:"mr-2 h-4 w-4 animate-spin"})):V("",!0),e[13]||(e[13]=C(" Complete Setup ",-1))]),_:1},8,["disabled"])],32),s(b)?(d(),p("div",ne,[n(a,{name:"lucide:alert-circle",class:"h-4 w-4"}),C(" "+A(s(b)),1)])):V("",!0)],64))])])}}});export{pe as default};
