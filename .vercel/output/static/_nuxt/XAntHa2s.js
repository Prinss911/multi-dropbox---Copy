import{d as J,B as Q,H as W,r as f,g as S,C as Y,h as G,c as d,a as t,j as w,t as u,f as l,b as r,n as y,v as I,p as K,w as X,F as Z,k as ee,l as x,m as $,e as b,y as T,_ as te,T as V,o as i,s as k}from"./D0_loxAU.js";import{_ as se}from"./2t6NhyjD.js";import{u as oe}from"./CxRmHzWs.js";import"./oVxJKGu7.js";import"./BNf5BS2b.js";const le={class:"h-full flex flex-col bg-background/50"},ne={class:"sticky top-0 z-20 bg-background/95 backdrop-blur border-b px-6 py-4"},ae={class:"w-full"},ie={class:"flex flex-col md:flex-row md:items-center justify-between gap-4"},re={class:"text-sm text-muted-foreground"},de={class:"flex items-center gap-3"},ue={class:"relative group hidden sm:block"},ce={class:"flex-1 overflow-auto px-4 md:px-6 py-6 transition-all"},me={class:"w-full h-full"},pe={key:0,class:"flex flex-col items-center justify-center py-20 text-muted-foreground"},fe={key:1,class:"bg-card rounded-xl border shadow-sm overflow-hidden"},xe={class:"w-full text-left border-collapse"},be={class:"divide-y divide-border/40"},ge={class:"py-4 px-6"},ve={class:"flex items-center gap-4"},he={class:"min-w-0"},ye={class:"font-medium text-sm text-[#1E1919] dark:text-foreground truncate"},we={class:"text-xs text-muted-foreground truncate"},ke={class:"py-4 px-6 hidden md:table-cell"},_e={class:"py-4 px-6 hidden sm:table-cell"},Ce={class:"py-4 px-6 text-sm text-muted-foreground hidden lg:table-cell"},Ee={class:"py-4 px-6 text-right"},Ue={class:"flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},Ie=["onClick"],Fe=["onClick"],De=["onClick","disabled"],Le={class:"bg-card w-full max-w-md rounded-xl shadow-2xl border-0 overflow-hidden animate-in fade-in zoom-in-95 duration-200"},je={class:"px-6 py-5 border-b bg-background flex items-center justify-between"},Ae={class:"font-semibold text-lg text-[#1E1919] dark:text-foreground flex items-center gap-2"},Se={class:"p-6 space-y-4"},$e={key:0,class:"space-y-1.5"},Te={class:"space-y-1.5"},Ve={class:"relative"},Me=["disabled"],ze={key:0,class:"text-xs text-muted-foreground mt-1"},Pe={class:"grid grid-cols-2 gap-4"},Re={class:"space-y-1.5"},Be={class:"relative"},Ne={key:0,class:"space-y-1.5"},Oe={class:"relative"},qe={class:"pt-2"},He=["disabled"],Je={key:1},Qe={class:"bg-card w-full max-w-[400px] rounded-xl shadow-2xl border-0 overflow-hidden animate-in fade-in zoom-in-95 duration-200 p-6"},We={class:"flex flex-col items-center text-center gap-4"},Ye={class:"h-12 w-12 rounded-full bg-red-50 flex items-center justify-center text-red-600 mb-2"},Ge={class:"text-sm text-muted-foreground mt-2 px-4"},Ke={class:"font-medium text-foreground"},Xe={class:"flex gap-3 w-full mt-2"},Ze=["disabled"],at=J({__name:"users",setup(et){const F=Q(),{authFetch:_}=oe(),{user:C}=W(),p=f(!1),g=f(!1),m=f(null),v=f(""),E=f([]),U=async()=>{p.value=!0;try{const{data:s,error:e}=await F.from("profiles").select("*").order("created_at",{ascending:!1});if(e)throw e;E.value=s||[]}catch(s){console.error("Failed to fetch users:",s)}finally{p.value=!1}},M=S(()=>{let s=E.value.map(e=>{let n="Invited";return e.status==="active"?n="Active":e.status==="inactive"?n="Inactive":(e.status==="invited"||!e.status)&&(n="Invited"),{id:e.id,name:e.name||"",email:e.email||"Unknown",role:e.role||"user",status:n,lastLogin:new Date(e.updated_at||e.created_at).toISOString()}});if(v.value){const e=v.value.toLowerCase();s=s.filter(n=>n.name.toLowerCase().includes(e)||n.email.toLowerCase().includes(e))}return s}),z=S(()=>E.value),h=f(!1),c=f(null),a=Y({name:"",email:"",role:"user",status:"Active"});G(()=>{U()});const P=s=>s?s.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?",R=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),D=(s=null)=>{c.value=s,s?(a.name=s.name,a.email=s.email,a.role=s.role,a.status=s.status):(a.name="",a.email="",a.role="user",a.status="Invited"),h.value=!0},B=async()=>{p.value=!0;try{if(c.value){const{error:s}=await F.from("profiles").update({name:a.name,role:a.role.toLowerCase()}).eq("id",c.value.id);if(s)throw s}else{const s=await _("/api/auth/invite",{method:"POST",body:{email:a.email,role:a.role.toLowerCase()}});s.link?alert(`Invitation sent! 

IMPORTANT: Use this link if the email doesn't arrive:
${s.link}`):alert("Invitation sent! Please check your email inbox.")}h.value=!1,await U()}catch(s){alert(s.message||"Operation failed")}finally{p.value=!1}},N=s=>{var e;if(s.id===((e=C.value)==null?void 0:e.id)){alert("You cannot delete your own account!");return}m.value=s},O=async()=>{var s;if(m.value){g.value=!0;try{await _(`/api/user/${m.value.id}`,{method:"DELETE"}),m.value=null,await U()}catch(e){console.error("Delete user error:",e),alert(((s=e.data)==null?void 0:s.message)||e.message||"Failed to delete user")}finally{g.value=!1}}},q=async s=>{if(confirm(`Resend invitation to ${s.email}?`))try{const e=await _("/api/auth/invite",{method:"POST",body:{email:s.email,role:s.role}});e.link?alert(`Invitation resent! 

Link: ${e.link}`):alert("Invitation email resent. Please check the inbox.")}catch(e){alert(e.message)}};return(s,e)=>{const n=te,H=se;return i(),d("div",le,[t("div",ne,[t("div",ae,[t("div",ie,[t("div",null,[e[10]||(e[10]=t("h1",{class:"text-xl font-semibold text-[#1E1919] dark:text-foreground"},"Users & Roles",-1)),t("p",re,"Manage access for "+u(l(z).length)+" users",1)]),t("div",de,[t("div",ue,[r(n,{name:"lucide:search",class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground group-focus-within:text-primary transition-colors"}),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>K(v)?v.value=o:null),type:"text",placeholder:"Find user...",class:"h-10 pl-9 pr-4 w-64 rounded-full border bg-muted/20 hover:bg-muted/40 focus:bg-background focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-sm"},null,512),[[I,l(v)]])]),r(H,{onClick:e[1]||(e[1]=o=>D()),class:"bg-[#0061FE] hover:bg-[#0057E5] text-white"},{default:X(()=>[r(n,{name:"lucide:mail-plus",class:"mr-2 h-4 w-4"}),e[11]||(e[11]=b(" Invite User ",-1))]),_:1})])])])]),t("div",ce,[t("div",me,[l(p)?(i(),d("div",pe,[r(n,{name:"lucide:loader-2",class:"animate-spin h-8 w-8 text-[#0061FE] mb-4"}),e[12]||(e[12]=t("p",{class:"text-sm"},"Loading users...",-1))])):(i(),d("div",fe,[t("table",xe,[e[14]||(e[14]=t("thead",{class:"bg-muted/30"},[t("tr",null,[t("th",{class:"py-3 px-6 text-xs font-semibold text-muted-foreground uppercase tracking-wider border-b w-[40%]"},"User"),t("th",{class:"py-3 px-6 text-xs font-semibold text-muted-foreground uppercase tracking-wider border-b hidden md:table-cell"},"Role"),t("th",{class:"py-3 px-6 text-xs font-semibold text-muted-foreground uppercase tracking-wider border-b hidden sm:table-cell"},"Status"),t("th",{class:"py-3 px-6 text-xs font-semibold text-muted-foreground uppercase tracking-wider border-b hidden lg:table-cell"},"Last Login"),t("th",{class:"py-3 px-6 text-right text-xs font-semibold text-muted-foreground uppercase tracking-wider border-b"},"Actions")])],-1)),t("tbody",be,[(i(!0),d(Z,null,ee(l(M),o=>{var L,j;return i(),d("tr",{key:o.id,class:"group hover:bg-[#F7F9FA] dark:hover:bg-muted/20 transition-colors"},[t("td",ge,[t("div",ve,[t("div",{class:k(["h-10 w-10 rounded-full flex items-center justify-center text-sm font-bold shrink-0 text-white shadow-sm",[o.role==="admin"?"bg-gradient-to-br from-purple-500 to-indigo-600":"bg-gradient-to-br from-blue-400 to-blue-600"]])},u(P(o.name||o.email)),3),t("div",he,[t("p",ye,u(o.name||(o.status==="Invited"?"Pending Invite":o.email.split("@")[0])),1),t("p",we,u(o.email),1)])])]),t("td",ke,[t("span",{class:k(["inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium capitalize whitespace-nowrap",[o.role==="admin"?"bg-purple-100 text-purple-700 dark:bg-purple-500/20 dark:text-purple-400":"bg-blue-100 text-blue-700 dark:bg-blue-500/20 dark:text-blue-400"]])},[r(n,{name:o.role==="admin"?"lucide:shield-check":"lucide:user",class:"h-3 w-3"},null,8,["name"]),b(" "+u(o.role),1)],2)]),t("td",_e,[t("span",{class:k(["inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium whitespace-nowrap",{"bg-emerald-100 text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-400":o.status==="Active","bg-amber-100 text-amber-700 dark:bg-amber-500/20 dark:text-amber-400":o.status==="Invited","bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400":o.status==="Inactive"}])},[e[13]||(e[13]=t("span",{class:"h-1.5 w-1.5 rounded-full bg-current opacity-60"},null,-1)),b(" "+u(o.status),1)],2)]),t("td",Ce,u(R(o.lastLogin)),1),t("td",Ee,[t("div",Ue,[o.status==="Invited"?(i(),d("button",{key:0,onClick:A=>q(o),class:"h-8 px-3 rounded text-xs font-medium bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors mr-2"}," Resend ",8,Ie)):x("",!0),t("button",{onClick:A=>D(o),class:"h-8 w-8 flex items-center justify-center rounded hover:bg-muted text-muted-foreground hover:text-foreground transition-colors",title:"Edit User"},[r(n,{name:"lucide:pencil",class:"h-4 w-4"})],8,Fe),t("button",{onClick:A=>N(o),class:k(["h-8 w-8 flex items-center justify-center rounded hover:bg-red-50 text-muted-foreground hover:text-red-600 transition-colors",{"opacity-50 cursor-not-allowed":o.id===((L=l(C))==null?void 0:L.id)}]),title:"Delete User",disabled:o.id===((j=l(C))==null?void 0:j.id)},[r(n,{name:"lucide:trash-2",class:"h-4 w-4"})],10,De)])])])}),128))])])]))])]),(i(),w(V,{to:"body"},[l(h)?(i(),d("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-[#1E1919]/60 backdrop-blur-[2px]",onClick:e[7]||(e[7]=$(o=>h.value=!1,["self"]))},[t("div",Le,[t("div",je,[t("h3",Ae,[r(n,{name:l(c)?"lucide:user-cog":"lucide:mail-plus",class:"h-5 w-5 text-[#0061FE]"},null,8,["name"]),b(" "+u(l(c)?"Edit User":"Invite User"),1)]),t("button",{onClick:e[2]||(e[2]=o=>h.value=!1),class:"p-1 rounded-full hover:bg-muted text-muted-foreground transition-colors"},[r(n,{name:"lucide:x",class:"h-5 w-5"})])]),t("div",Se,[l(c)?(i(),d("div",$e,[e[15]||(e[15]=t("label",{class:"text-xs font-semibold uppercase text-muted-foreground"},"Full Name",-1)),y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>l(a).name=o),placeholder:"John Doe",class:"w-full h-10 px-3 rounded-lg border bg-background focus:ring-2 focus:ring-[#0061FE]/20 focus:border-[#0061FE] transition-all text-sm"},null,512),[[I,l(a).name]])])):x("",!0),t("div",Te,[e[16]||(e[16]=t("label",{class:"text-xs font-semibold uppercase text-muted-foreground"},"Email Address",-1)),t("div",Ve,[r(n,{name:"lucide:mail",class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),y(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>l(a).email=o),type:"email",placeholder:"colleague@example.com",disabled:!!l(c),class:"w-full h-10 pl-9 pr-3 rounded-lg border bg-background focus:ring-2 focus:ring-[#0061FE]/20 focus:border-[#0061FE] transition-all text-sm disabled:opacity-60 disabled:bg-muted/50"},null,8,Me),[[I,l(a).email]])]),l(c)?x("",!0):(i(),d("p",ze," We'll send an invitation link to this email. "))]),t("div",Pe,[t("div",Re,[e[18]||(e[18]=t("label",{class:"text-xs font-semibold uppercase text-muted-foreground"},"Role",-1)),t("div",Be,[y(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>l(a).role=o),class:"w-full h-10 pl-3 pr-8 rounded-lg border bg-background focus:ring-2 focus:ring-[#0061FE]/20 focus:border-[#0061FE] transition-all text-sm appearance-none"},[...e[17]||(e[17]=[t("option",{value:"user"},"User",-1),t("option",{value:"admin"},"Admin",-1)])],512),[[T,l(a).role]]),r(n,{name:"lucide:chevron-down",class:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"})])]),l(c)?(i(),d("div",Ne,[e[20]||(e[20]=t("label",{class:"text-xs font-semibold uppercase text-muted-foreground"},"Status",-1)),t("div",Oe,[y(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>l(a).status=o),class:"w-full h-10 pl-3 pr-8 rounded-lg border bg-background focus:ring-2 focus:ring-[#0061FE]/20 focus:border-[#0061FE] transition-all text-sm appearance-none"},[...e[19]||(e[19]=[t("option",{value:"Active"},"Active",-1),t("option",{value:"Inactive"},"Inactive",-1),t("option",{value:"Invited"},"Invited",-1)])],512),[[T,l(a).status]]),r(n,{name:"lucide:chevron-down",class:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"})])])):x("",!0)]),t("div",qe,[t("button",{onClick:B,disabled:l(p),class:"w-full h-11 rounded-lg bg-[#0061FE] hover:bg-[#0057E5] text-white font-semibold text-sm shadow-sm transition-all flex items-center justify-center gap-2 disabled:opacity-70"},[l(p)?(i(),w(n,{key:0,name:"lucide:loader-2",class:"h-5 w-5 animate-spin"})):(i(),d("span",Je,u(l(c)?"Save Changes":"Send Invitation"),1))],8,He)])])])])):x("",!0)])),(i(),w(V,{to:"body"},[l(m)?(i(),d("div",{key:0,class:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-[#1E1919]/60 backdrop-blur-[2px]",onClick:e[9]||(e[9]=$(o=>m.value=null,["self"]))},[t("div",Qe,[t("div",We,[t("div",Ye,[r(n,{name:"lucide:user-x",class:"h-6 w-6"})]),t("div",null,[e[24]||(e[24]=t("h3",{class:"text-lg font-semibold text-[#1E1919] dark:text-foreground"},"Delete User?",-1)),t("p",Ge,[e[21]||(e[21]=b(" Are you sure you want to remove access for ",-1)),e[22]||(e[22]=t("br",null,null,-1)),t("span",Ke,u(l(m).name||l(m).email),1),e[23]||(e[23]=b("? ",-1))]),e[25]||(e[25]=t("p",{class:"text-xs text-red-500/80 mt-2 font-medium"},"This action cannot be undone.",-1))]),t("div",Xe,[t("button",{onClick:e[8]||(e[8]=o=>m.value=null),class:"flex-1 h-10 rounded-lg border hover:bg-muted transition-colors text-sm font-medium"}," Cancel "),t("button",{onClick:O,disabled:l(g),class:"flex-1 h-10 rounded-lg bg-red-600 hover:bg-red-700 text-white transition-colors text-sm font-medium flex items-center justify-center gap-2 disabled:opacity-70"},[l(g)?(i(),w(n,{key:0,name:"lucide:loader-2",class:"h-4 w-4 animate-spin"})):x("",!0),b(" "+u(l(g)?"Deleting...":"Delete User"),1)],8,Ze)])])])])):x("",!0)]))])}}});export{at as default};
