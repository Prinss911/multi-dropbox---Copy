import{d as Q,r as b,g as N,C as X,h as Y,i as Z,c as v,a as n,j as D,b as l,t as g,f as t,e as p,l as $,F as O,w as r,T as ee,o as f,_ as te,s as _,k as se}from"./D0_loxAU.js";import{_ as ae}from"./2t6NhyjD.js";import{_ as le,a as ne,b as oe,c as ie,d as de,e as re}from"./8Jew3ux9.js";import{a as ce,u as ue}from"./DfhhxIwp.js";import"./oVxJKGu7.js";import"./BNf5BS2b.js";import"./CxRmHzWs.js";const me={class:"space-y-4"},fe={class:"flex items-center justify-between"},pe={class:"flex items-center gap-3"},he={class:"p-2 rounded-lg bg-red-500/10"},ge={class:"text-sm text-muted-foreground"},ve={class:"text-xs text-amber-600 dark:text-amber-400 mt-1"},xe={class:"flex items-center gap-2"},be={key:0,class:"rounded-md border bg-card p-8"},_e={class:"flex flex-col items-center justify-center gap-2 text-muted-foreground"},ye={key:1,class:"rounded-md border border-destructive/50 bg-destructive/10 p-8"},we={class:"flex flex-col items-center justify-center gap-2 text-destructive"},ke={class:"text-sm"},Te={key:2,class:"rounded-md border-2 border-dashed bg-card p-12"},Ce={class:"flex flex-col items-center justify-center gap-3 text-muted-foreground"},$e={key:3,class:"rounded-md border bg-card text-card-foreground shadow-sm"},Pe=["checked","indeterminate"],Se=["checked","onChange"],De={class:"p-2 rounded bg-muted shrink-0"},Re={class:"flex flex-col min-w-0"},Fe={class:"text-sm font-medium text-foreground truncate"},Ie={class:"md:hidden flex flex-wrap items-center gap-2 text-xs mt-0.5"},ze={class:"font-medium text-muted-foreground"},Ae={key:0,class:"text-muted-foreground"},Ne={class:"text-xs font-medium px-2 py-1 rounded bg-muted text-muted-foreground"},Oe={key:1,class:"text-xs text-muted-foreground"},je={class:"flex items-center justify-end gap-2"},Ue={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},Be={class:"bg-card w-full max-w-sm rounded-lg shadow-lg border p-6"},Ee={class:"flex items-center gap-3 mb-4"},Le={class:"p-2 rounded-full bg-destructive/10"},Ve={class:"font-semibold text-lg text-foreground"},He={class:"text-muted-foreground mb-6"},We={class:"flex gap-3 justify-end"},Ze=Q({__name:"trash",setup(qe){const{getFileIcon:j}=ce(),{accounts:I}=ue(),c=b([]),R=b(!0),P=b(null),k=b(null),T=b(null),C=b(!1),u=b(new Set),x=b(!1),z=N(()=>c.value.length>0&&c.value.every(s=>u.value.has(s.id))),U=N(()=>{const s=c.value.filter(e=>u.value.has(e.id)).length;return s>0&&s<c.value.length}),B=s=>{const e=new Set(u.value);e.has(s)?e.delete(s):e.add(s),u.value=e},E=()=>{z.value?u.value=new Set:u.value=new Set(c.value.map(s=>s.id))},L=()=>{u.value=new Set},h=X({isOpen:!1,title:"Confirm",message:"",confirmText:"Delete",resolve:s=>{}}),S=s=>new Promise(e=>{h.title=s.title||"Confirm",h.message=s.message,h.confirmText=s.confirmText||"Delete",h.resolve=e,h.isOpen=!0}),F=async()=>{var s;R.value=!0,P.value=null,c.value=[];try{const e=I.value.map(async a=>{try{return(await $fetch("/api/dropbox/trash",{query:{accountId:a.id}})).entries.map(y=>({...y,accountId:a.id,accountName:a.name}))}catch(m){return console.warn(`Failed to fetch trash for ${a.name}:`,m),[]}}),i=(await Promise.all(e)).flat();c.value=i.sort((a,m)=>(a.daysRemaining||99)-(m.daysRemaining||99))}catch(e){P.value=((s=e.data)==null?void 0:s.message)||e.message||"Failed to load trash"}finally{R.value=!1}};Y(()=>{F()}),Z(I,()=>{F()},{deep:!0});const V=s=>{if(!s)return"/";const e=s.split("/");return e.pop(),e.join("/")||"/"},H=async s=>{var e;if(s.path){k.value=s.id;try{await $fetch("/api/dropbox/restore",{method:"POST",body:{path:s.path,accountId:s.accountId}}),c.value=c.value.filter(o=>o.id!==s.id)}catch(o){alert(((e=o.data)==null?void 0:e.message)||"Failed to restore file")}finally{k.value=null}}},W=async s=>{var o;if(!(!s.path||!await S({title:"Permanent Delete",message:`Permanently delete "${s.name}"? This cannot be undone.`,confirmText:"Delete Forever"}))){T.value=s.id;try{const i=await $fetch("/api/dropbox/permanent-delete",{method:"POST",body:{path:s.path,accountId:s.accountId}});c.value=c.value.filter(a=>a.id!==s.id),(i.isPersonalAccount||i.alreadyInTrash)&&alert("Note: For personal Dropbox accounts, files in trash will be automatically deleted after 30 days.")}catch(i){console.error("Permanent delete error:",i);const a=((o=i.data)==null?void 0:o.message)||i.message||"Failed to permanently delete";alert(a)}finally{T.value=null}}},q=async()=>{if(!await S({title:"Empty Trash",message:"Permanently delete all files in trash? This cannot be undone.",confirmText:"Empty Trash"}))return;C.value=!0;const e=[...c.value];let o=0,i=!1;for(const a of e)if(a.path)try{const m=await $fetch("/api/dropbox/permanent-delete",{method:"POST",body:{path:a.path,accountId:a.accountId}});c.value=c.value.filter(y=>y.id!==a.id),o++,(m.isPersonalAccount||m.alreadyInTrash)&&(i=!0)}catch(m){console.error("Error deleting:",a.name,m)}C.value=!1,i&&o>0&&alert(`${o} file(s) processed. Note: For personal Dropbox accounts, files in trash will be automatically deleted after 30 days.`)},M=async()=>{if(u.value.size===0||!await S({title:"Restore Selected",message:`Restore ${u.value.size} selected file(s)?`,confirmText:"Restore All"}))return;x.value=!0;const e=Array.from(u.value);for(const o of e){const i=c.value.find(a=>a.id===o);if(i!=null&&i.path)try{await $fetch("/api/dropbox/restore",{method:"POST",body:{path:i.path,accountId:i.accountId}}),c.value=c.value.filter(a=>a.id!==o)}catch(a){console.error(`Failed to restore ${i.name}:`,a)}}u.value=new Set,x.value=!1},G=async()=>{if(u.value.size===0||!await S({title:"Permanently Delete Selected",message:`Permanently delete ${u.value.size} selected file(s)? This cannot be undone.`,confirmText:"Delete All Forever"}))return;x.value=!0;const e=Array.from(u.value);let o=!1;for(const i of e){const a=c.value.find(m=>m.id===i);if(a!=null&&a.path)try{const m=await $fetch("/api/dropbox/permanent-delete",{method:"POST",body:{path:a.path,accountId:a.accountId}});c.value=c.value.filter(y=>y.id!==i),(m.isPersonalAccount||m.alreadyInTrash)&&(o=!0)}catch(m){console.error(`Failed to delete ${a.name}:`,m)}}u.value=new Set,x.value=!1,o&&alert("Note: For personal Dropbox accounts, files in trash will be automatically deleted after 30 days.")};return(s,e)=>{const o=te,i=ae,a=ie,m=oe,y=ne,w=re,J=de,K=le;return f(),v("div",me,[n("div",fe,[n("div",pe,[n("div",he,[l(o,{name:"lucide:trash-2",class:"h-5 w-5 text-red-500"})]),n("div",null,[e[3]||(e[3]=n("h1",{class:"text-xl font-semibold"},"Trash",-1)),n("p",ge,g(t(u).size>0?`${t(u).size} selected`:"Deleted files are automatically removed after 30 days"),1),n("p",ve,[l(o,{name:"lucide:info",class:"h-3 w-3 inline mr-1"}),e[2]||(e[2]=p(" Personal accounts: Permanent delete via API not supported. Use Dropbox.com to empty trash immediately. ",-1))])])]),n("div",xe,[t(u).size>0?(f(),v(O,{key:0},[l(i,{variant:"outline",size:"sm",onClick:L},{default:r(()=>[...e[4]||(e[4]=[p(" Clear ",-1)])]),_:1}),l(i,{variant:"outline",size:"sm",onClick:M,disabled:t(x)},{default:r(()=>[l(o,{name:t(x)?"lucide:loader-2":"lucide:undo-2",class:_(["mr-2 h-4 w-4",t(x)&&"animate-spin"])},null,8,["name","class"]),p(" Restore "+g(t(u).size),1)]),_:1},8,["disabled"]),l(i,{variant:"destructive",size:"sm",onClick:G,disabled:t(x)},{default:r(()=>[l(o,{name:t(x)?"lucide:loader-2":"lucide:trash-2",class:_(["mr-2 h-4 w-4",t(x)&&"animate-spin"])},null,8,["name","class"]),p(" Delete "+g(t(u).size),1)]),_:1},8,["disabled"])],64)):t(c).length>0?(f(),D(i,{key:1,variant:"destructive",size:"sm",onClick:q,disabled:t(C)},{default:r(()=>[l(o,{name:t(C)?"lucide:loader-2":"lucide:trash",class:_(["mr-2 h-4 w-4",t(C)&&"animate-spin"])},null,8,["name","class"]),e[5]||(e[5]=p(" Empty Trash ",-1))]),_:1},8,["disabled"])):$("",!0)])]),t(R)?(f(),v("div",be,[n("div",_e,[l(o,{name:"lucide:loader-2",class:"h-8 w-8 animate-spin"}),e[6]||(e[6]=n("p",null,"Loading trash...",-1))])])):t(P)?(f(),v("div",ye,[n("div",we,[l(o,{name:"lucide:alert-circle",class:"h-8 w-8"}),e[8]||(e[8]=n("p",{class:"font-medium"},"Failed to load trash",-1)),n("p",ke,g(t(P)),1),l(i,{variant:"outline",size:"sm",onClick:F,class:"mt-2"},{default:r(()=>[l(o,{name:"lucide:refresh-cw",class:"mr-2 h-4 w-4"}),e[7]||(e[7]=p(" Retry ",-1))]),_:1})])])):t(c).length===0?(f(),v("div",Te,[n("div",Ce,[l(o,{name:"lucide:trash-2",class:"h-16 w-16"}),e[9]||(e[9]=n("p",{class:"font-medium text-lg"},"Trash is empty",-1)),e[10]||(e[10]=n("p",{class:"text-sm"},"Deleted files will appear here",-1))])])):(f(),v("div",$e,[l(K,null,{default:r(()=>[l(y,null,{default:r(()=>[l(m,{class:"hover:bg-transparent"},{default:r(()=>[l(a,{class:"w-10"},{default:r(()=>[n("input",{type:"checkbox",checked:t(z),indeterminate:t(U),onChange:E,class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"},null,40,Pe)]),_:1}),l(a,{class:"min-w-[200px]"},{default:r(()=>[...e[11]||(e[11]=[p("Name",-1)])]),_:1}),l(a,{class:"hidden md:table-cell"},{default:r(()=>[...e[12]||(e[12]=[p("Account",-1)])]),_:1}),l(a,{class:"hidden md:table-cell"},{default:r(()=>[...e[13]||(e[13]=[p("Location",-1)])]),_:1}),l(a,{class:"hidden md:table-cell"},{default:r(()=>[...e[14]||(e[14]=[p("Expires",-1)])]),_:1}),l(a,{class:"text-right"},{default:r(()=>[...e[15]||(e[15]=[p("Actions",-1)])]),_:1})]),_:1})]),_:1}),l(J,null,{default:r(()=>[(f(!0),v(O,null,se(t(c),d=>(f(),D(m,{key:d.id,class:_(["group",{"bg-blue-50 dark:bg-blue-500/10":t(u).has(d.id)}])},{default:r(()=>[l(w,{class:"py-3"},{default:r(()=>[n("input",{type:"checkbox",checked:t(u).has(d.id),onChange:A=>B(d.id),class:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"},null,40,Se)]),_:2},1024),l(w,{class:"font-medium flex items-center gap-3 py-3"},{default:r(()=>[n("div",De,[l(o,{name:t(j)(d),class:"h-4 w-4 text-muted-foreground"},null,8,["name"])]),n("div",Re,[n("span",Fe,g(d.name),1),n("div",Ie,[n("span",ze,g(d.accountName),1),d.accountName?(f(),v("span",Ae,"â€¢")):$("",!0),d.daysRemaining!==null?(f(),v("span",{key:1,class:_([d.daysRemaining<=7?"text-red-500":d.daysRemaining<=14?"text-yellow-600":"text-muted-foreground"])},g(d.daysRemaining)+"d left ",3)):$("",!0)])])]),_:2},1024),l(w,{class:"hidden md:table-cell"},{default:r(()=>[n("span",Ne,g(d.accountName),1)]),_:2},1024),l(w,{class:"text-muted-foreground text-sm hidden md:table-cell"},{default:r(()=>[p(g(V(d.path)),1)]),_:2},1024),l(w,{class:"hidden md:table-cell"},{default:r(()=>[d.daysRemaining!==null?(f(),v("span",{key:0,class:_(["inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium",d.daysRemaining<=7?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":d.daysRemaining<=14?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-muted text-muted-foreground"])},[d.daysRemaining<=7?(f(),D(o,{key:0,name:"lucide:alert-triangle",class:"h-3 w-3"})):$("",!0),p(" "+g(d.daysRemaining)+" days left ",1)],2)):(f(),v("span",Oe,"Unknown"))]),_:2},1024),l(w,{class:"text-right"},{default:r(()=>[n("div",je,[l(i,{variant:"outline",size:"sm",onClick:A=>H(d),disabled:t(k)===d.id},{default:r(()=>[l(o,{name:t(k)===d.id?"lucide:loader-2":"lucide:undo-2",class:_(["mr-2 h-4 w-4",t(k)===d.id&&"animate-spin"])},null,8,["name","class"]),e[16]||(e[16]=p(" Restore ",-1))]),_:2},1032,["onClick","disabled"]),l(i,{variant:"destructive",size:"sm",onClick:A=>W(d),disabled:t(T)===d.id},{default:r(()=>[l(o,{name:t(T)===d.id?"lucide:loader-2":"lucide:trash-2",class:_(["mr-2 h-4 w-4",t(T)===d.id&&"animate-spin"])},null,8,["name","class"]),e[17]||(e[17]=p(" Delete ",-1))]),_:2},1032,["onClick","disabled"])])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})])),(f(),D(ee,{to:"body"},[t(h).isOpen?(f(),v("div",Ue,[n("div",Be,[n("div",Ee,[n("div",Le,[l(o,{name:"lucide:alert-triangle",class:"h-5 w-5 text-destructive"})]),n("h3",Ve,g(t(h).title),1)]),n("p",He,g(t(h).message),1),n("div",We,[n("button",{onClick:e[0]||(e[0]=d=>{t(h).resolve(!1),t(h).isOpen=!1}),class:"px-4 py-2 rounded-md text-sm font-medium border border-input bg-background hover:bg-muted transition-colors"}," Cancel "),n("button",{onClick:e[1]||(e[1]=d=>{t(h).resolve(!0),t(h).isOpen=!1}),class:"px-4 py-2 rounded-md text-sm font-medium bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-colors"},g(t(h).confirmText),1)])])])):$("",!0)]))])}}});export{Ze as default};
